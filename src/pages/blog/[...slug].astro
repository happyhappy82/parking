---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const title = `${post.data.title} | ParkingMap`;
const description = post.data.description;
const canonical = `https://parkingmap.kr/blog/${post.slug}/`;
const publishedTime = post.data.date;

const breadcrumbs = [
  { name: '홈', url: 'https://parkingmap.kr/' },
  { name: '블로그', url: 'https://parkingmap.kr/blog/' },
  { name: post.data.breadcrumbName || post.data.title.slice(0, 20), url: canonical },
];

const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": post.data.title,
  "description": description,
  "author": {
    "@type": "Organization",
    "name": "주차장 지도",
    "url": "https://parkingmap.kr"
  },
  "publisher": {
    "@type": "Organization",
    "name": "주차장 지도",
    "logo": {
      "@type": "ImageObject",
      "url": "https://parkingmap.kr/og-image.png"
    }
  },
  "datePublished": publishedTime,
  "dateModified": publishedTime,
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonical
  },
  "image": "https://parkingmap.kr/og-image.png"
};
---

<BaseLayout title={title} description={description} canonical={canonical} ogType="article" publishedTime={publishedTime} breadcrumbs={breadcrumbs}>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
  </Fragment>

  <Header />

  <article class="max-w-3xl mx-auto">
    <div class="mb-8">
      <a href="/blog/" class="text-sm text-emerald-700 hover:underline">&larr; 블로그 목록</a>
    </div>

    <header class="mb-10">
      <time class="text-sm text-gray-500" datetime={post.data.date}>{new Date(post.data.date).toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
      <h1 class="text-3xl font-black text-gray-900 mt-2">{post.data.title}</h1>
      <p class="text-gray-500 mt-3">{post.data.description}</p>
    </header>

    <div class="prose prose-gray max-w-none">
      <Content />
    </div>

    <!-- CTA -->
    <div class="mt-12 p-6 bg-emerald-50 rounded-2xl text-center">
      <p class="text-emerald-800 font-semibold mb-3">내 주변 주차장 찾아보기</p>
      <a
        href="/"
        class="inline-block px-6 py-3 bg-emerald-700 text-white font-semibold rounded-xl hover:bg-emerald-800 transition-colors"
      >
        주차장 검색하기
      </a>
    </div>

    <div class="mt-8 text-center">
      <a href="/blog/" class="text-sm text-gray-500 hover:text-emerald-700 transition-colors">다른 글 보러가기 &rarr;</a>
    </div>
  </article>
</BaseLayout>
