---
export const prerender = false;
---
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <title>ì£¼ì°¨ì¥ ê´€ë¦¬ | ParkingMap Admin</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f1f5f9;color:#1e293b;-webkit-font-smoothing:antialiased}

    /* â”€â”€ Sidebar â”€â”€ */
    .sidebar{position:fixed;top:0;left:0;width:220px;height:100vh;background:#0f172a;display:flex;flex-direction:column;z-index:50}
    .sidebar-header{padding:20px;border-bottom:1px solid rgba(255,255,255,.06)}
    .sidebar-logo{font-size:15px;font-weight:800;color:#e2e8f0;display:flex;align-items:center;gap:10px;text-decoration:none}
    .logo-icon{width:30px;height:30px;background:linear-gradient(135deg,#10b981,#059669);border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;font-weight:900;font-size:15px}
    .sidebar nav{flex:1;padding:16px 0}
    .sidebar nav a{display:flex;align-items:center;gap:10px;padding:10px 16px;margin:2px 8px;color:#94a3b8;text-decoration:none;font-size:13px;font-weight:500;border-radius:8px;transition:all .15s}
    .sidebar nav a:hover{color:#e2e8f0;background:rgba(255,255,255,.05)}
    .sidebar nav a.active{color:white;background:rgba(16,185,129,.15)}
    .nav-icon{font-size:16px;width:20px;text-align:center}
    .sidebar-footer{padding:16px 20px;border-top:1px solid rgba(255,255,255,.06)}
    .logout-btn{width:100%;padding:8px 12px;background:transparent;border:1px solid rgba(255,255,255,.1);color:#64748b;border-radius:6px;font-size:12px;cursor:pointer;transition:all .15s}
    .logout-btn:hover{background:rgba(255,255,255,.05);color:#94a3b8}

    /* â”€â”€ Main â”€â”€ */
    .main{margin-left:220px;padding:28px 32px;min-height:100vh}
    .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
    .page-header h1{font-size:22px;font-weight:800;color:#0f172a}
    .page-header .subtitle{font-size:13px;color:#64748b;margin-top:2px}

    /* â”€â”€ Controls â”€â”€ */
    .controls{background:white;border-radius:12px;padding:16px 20px;border:1px solid #e2e8f0;margin-bottom:20px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .controls input[type="text"]{flex:1;min-width:200px;padding:9px 12px;border:1px solid #e2e8f0;border-radius:8px;font-size:13px;outline:none;transition:border .15s;background:white;color:#1e293b}
    .controls input[type="text"]:focus{border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,.1)}
    .controls select{padding:9px 12px;border:1px solid #e2e8f0;border-radius:8px;font-size:13px;outline:none;cursor:pointer;background:white;color:#1e293b;transition:border .15s}
    .controls select:focus{border-color:#10b981}

    /* â”€â”€ Table (Google Sheets ìŠ¤íƒ€ì¼) â”€â”€ */
    .table-card{background:white;border-radius:8px;overflow:hidden;border:1px solid #c0c0c0}
    table{width:100%;border-collapse:collapse}
    thead th{text-align:left;padding:8px 12px;font-size:12px;font-weight:600;color:#444;background:#f3f3f3;border-bottom:2px solid #c0c0c0;border-right:1px solid #e0e0e0;white-space:nowrap}
    thead th:last-child{border-right:none}
    tbody td{padding:8px 12px;font-size:13px;border-bottom:1px solid #e0e0e0;border-right:1px solid #e8e8e8;vertical-align:middle}
    tbody td:last-child{border-right:none}
    tbody tr{cursor:pointer;transition:background .12s}
    tbody tr:hover{background:#e8f0fe}
    tbody tr:last-child td{border-bottom:none}
    .badge{display:inline-block;padding:2px 8px;border-radius:5px;font-size:10px;font-weight:700;letter-spacing:.02em}
    .badge-ë…¸ìƒ{background:#ecfdf5;color:#059669}
    .badge-ë…¸ì™¸{background:#dbeafe;color:#2563eb}
    .badge-ë¶€ì„¤{background:#fef3c7;color:#d97706}
    .badge-ê³µì˜{background:#f3e8ff;color:#7c3aed}
    .parking-name{font-weight:600;color:#0f172a}
    .parking-addr{font-size:11px;color:#94a3b8;margin-top:2px;max-width:280px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .has-editorial{display:inline-block;width:8px;height:8px;background:#10b981;border-radius:50%;margin-left:6px;vertical-align:middle}
    .loading{text-align:center;padding:60px;color:#94a3b8;font-size:14px}
    .empty{text-align:center;padding:60px;color:#94a3b8;font-size:14px}
    .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;transition:all .15s;text-decoration:none;white-space:nowrap}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn-primary{background:#10b981;color:white}
    .btn-primary:hover{background:#059669}
    .btn-gray{background:#e2e8f0;color:#475569}
    .btn-gray:hover{background:#cbd5e1}
    .btn-view{background:#f1f5f9;color:#475569;padding:4px 10px;font-size:11px;border:1px solid #e2e8f0;border-radius:6px}
    .btn-view:hover{background:#e2e8f0}
    .td-actions{display:flex;gap:6px;align-items:center}

    /* â”€â”€ Modal â”€â”€ */
    .modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(15,23,42,.5);z-index:100;backdrop-filter:blur(2px)}
    .modal{position:fixed;top:3%;left:50%;transform:translateX(-50%);width:92%;max-width:860px;max-height:94vh;background:white;border-radius:16px;z-index:101;display:flex;flex-direction:column;box-shadow:0 25px 60px rgba(0,0,0,.15)}
    .modal-header{padding:18px 24px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center}
    .modal-header h2{font-size:17px;font-weight:800;color:#0f172a}
    .modal-header .header-sub{font-size:11px;color:#94a3b8;margin-top:2px;font-family:'SF Mono','Fira Code',monospace}

    /* â”€â”€ Modal Tabs â”€â”€ */
    .modal-tabs{display:flex;gap:0;border-bottom:1px solid #e2e8f0;padding:0 24px;background:#f8fafc}
    .modal-tab{padding:11px 18px;border:none;background:none;font-size:13px;font-weight:600;color:#64748b;cursor:pointer;position:relative;transition:color .15s}
    .modal-tab:hover{color:#1e293b}
    .modal-tab.active{color:#10b981}
    .modal-tab.active::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:2px;background:#10b981}
    .tab-count{display:inline-block;margin-left:5px;padding:1px 7px;border-radius:10px;font-size:10px;font-weight:700;background:rgba(100,116,139,.12);color:#64748b}
    .modal-tab.active .tab-count{background:rgba(16,185,129,.12);color:#10b981}
    .tab-panel{display:none}
    .tab-panel.active{display:block}

    /* â”€â”€ Modal Body â”€â”€ */
    .modal-body{padding:0;overflow-y:auto;flex:1}
    .modal-body .tab-panel{padding:20px 24px}
    .modal-footer{padding:14px 24px;border-top:1px solid #e2e8f0;display:flex;gap:10px;justify-content:flex-end}

    /* â”€â”€ Form Section â”€â”€ */
    .form-section{margin-bottom:20px}
    .form-section-title{font-size:12px;font-weight:700;color:#10b981;text-transform:uppercase;letter-spacing:.06em;margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid #f1f5f9;display:flex;align-items:center;gap:6px}
    .form-section-title span{font-size:14px}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
    .form-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:10px}
    .form-group{margin-bottom:10px}
    .form-group label{display:block;font-size:11px;font-weight:600;color:#64748b;margin-bottom:4px;letter-spacing:.02em}
    .form-group input,.form-group textarea,.form-group select{width:100%;padding:8px 10px;border:1px solid #e2e8f0;border-radius:7px;font-size:13px;color:#1e293b;outline:none;font-family:inherit;transition:all .15s;background:white}
    .form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,.08)}
    .form-group input[readonly]{background:#f8fafc;color:#64748b;cursor:not-allowed;border-color:#f1f5f9}
    .form-group textarea{min-height:120px;resize:vertical;line-height:1.6}
    .form-group select{cursor:pointer}
    .readonly-hint{font-size:10px;color:#94a3b8;margin-top:2px;font-style:italic}
    .msg{padding:10px 14px;border-radius:8px;font-size:13px;margin-top:10px;display:none}
    .msg-success{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0}
    .msg-error{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}

    /* â”€â”€ Photo Management â”€â”€ */
    .photo-drop{border:2px dashed #d1d5db;border-radius:12px;padding:36px 20px;text-align:center;cursor:pointer;transition:all .2s;background:#fafafa;margin-bottom:14px}
    .photo-drop:hover,.photo-drop.dragover{border-color:#10b981;background:#ecfdf5}
    .photo-drop-icon{font-size:36px;margin-bottom:6px}
    .photo-drop-text{font-size:13px;color:#64748b}
    .photo-drop-sub{font-size:11px;color:#94a3b8;margin-top:3px}
    .photo-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin-top:14px}
    .photo-item{position:relative;border-radius:10px;overflow:hidden;background:#f1f5f9;aspect-ratio:4/3}
    .photo-item img{width:100%;height:100%;object-fit:cover}
    .photo-item .photo-delete{position:absolute;top:5px;right:5px;width:26px;height:26px;border-radius:50%;background:rgba(220,38,38,.9);color:white;border:none;cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .15s}
    .photo-item:hover .photo-delete{opacity:1}
    .photo-item .photo-name{position:absolute;bottom:0;left:0;right:0;padding:3px 6px;background:rgba(0,0,0,.55);color:white;font-size:10px;text-align:center}
    .photo-msg{font-size:13px;margin-top:6px}
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="sidebar-header">
      <a href="/admin/parking/" class="sidebar-logo">
        <div class="logo-icon">P</div>
        ParkingMap
      </a>
    </div>
    <nav>
      <a href="/admin/parking/" class="active"><span class="nav-icon">ğŸ…¿ï¸</span> ì£¼ì°¨ì¥ ê´€ë¦¬</a>
      <a href="/admin/blog/"><span class="nav-icon">ğŸ“</span> ë¸”ë¡œê·¸ ê´€ë¦¬</a>
    </nav>
    <div class="sidebar-footer">
      <button class="logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </aside>

  <div class="main">
    <div class="page-header">
      <div>
        <h1 id="pageTitle">ì£¼ì°¨ì¥ ê´€ë¦¬</h1>
        <p class="subtitle" id="pageSubtitle">ë°ì´í„° ë¡œë”© ì¤‘...</p>
      </div>
    </div>

    <div class="controls">
      <input type="text" id="searchInput" placeholder="ì£¼ì°¨ì¥ ì´ë¦„ ë˜ëŠ” ì£¼ì†Œ ê²€ìƒ‰..." />
      <select id="districtFilter">
        <option value="">ì „ì²´ êµ¬</option>
      </select>
      <select id="typeFilter">
        <option value="">ì „ì²´ ë¶„ë¥˜</option>
        <option value="ë…¸ìƒ">ë…¸ìƒ</option>
        <option value="ë…¸ì™¸">ë…¸ì™¸</option>
        <option value="ë¶€ì„¤">ë¶€ì„¤</option>
      </select>
    </div>

    <div class="table-card">
      <div id="loadingState" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
      <div id="emptyState" class="empty" style="display:none;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
      <table id="parkingTable" style="display:none;">
        <thead>
          <tr>
            <th>êµ¬</th>
            <th>ì£¼ì°¨ì¥</th>
            <th>ë¶„ë¥˜</th>
            <th>ì†Œì¬ì§€</th>
            <th style="width:100px;">ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody id="parkingTableBody"></tbody>
      </table>
    </div>
  </div>

  <!-- í¸ì§‘ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-header">
        <div>
          <h2 id="modalTitle">-</h2>
          <p class="header-sub" id="modalSubtitle"></p>
        </div>
        <button class="btn btn-gray" id="modalClose" style="padding:6px 12px;font-size:12px;">ë‹«ê¸°</button>
      </div>
      <div class="modal-tabs">
        <button class="modal-tab active" data-tab="form">ë°ì´í„° í¸ì§‘</button>
        <button class="modal-tab" data-tab="photos">ì‚¬ì§„ ê´€ë¦¬ <span class="tab-count" id="photoCount">0</span></button>
      </div>
      <div class="modal-body">
        <!-- ë°ì´í„° í¸ì§‘ íƒ­ (í¼) -->
        <div class="tab-panel active" id="tabForm">
          <div class="form-section">
            <div class="form-section-title"><span>ğŸ“Œ</span> ê³µë‹¨ì£¼ì†Œ ì›ë³¸ ë°ì´í„° (ì½ê¸° ì „ìš©)</div>
            <p class="readonly-hint">ì•„ë˜ ë°ì´í„°ëŠ” ê³µë‹¨ í™ˆí˜ì´ì§€ì—ì„œ ìˆ˜ì§‘í•œ ì›ë³¸ì…ë‹ˆë‹¤. ìˆ˜ì •ì´ í•„ìš”í•˜ë©´ ê³µë‹¨ì£¼ì†Œ JSONì„ ì§ì ‘ í¸ì§‘í•˜ì„¸ìš”.</p>
            <div class="form-group" style="margin-top:10px">
              <label>ì£¼ì°¨ì¥ëª…</label>
              <input type="text" id="f_name" readonly />
            </div>
            <div class="form-row-3">
              <div class="form-group">
                <label>ë¶„ë¥˜</label>
                <input type="text" id="f_category" readonly />
              </div>
              <div class="form-group">
                <label>êµ¬íšìˆ˜</label>
                <input type="text" id="f_spaces" readonly />
              </div>
              <div class="form-group">
                <label>ê¸‰ì§€</label>
                <input type="text" id="f_grade" readonly />
              </div>
            </div>
            <div class="form-group">
              <label>ì†Œì¬ì§€</label>
              <input type="text" id="f_address" readonly />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>ë©´ì </label>
                <input type="text" id="f_area" readonly />
              </div>
              <div class="form-group">
                <label>ì¸ìˆ˜ì¼</label>
                <input type="text" id="f_transferDate" readonly />
              </div>
            </div>
          </div>

          <div class="form-section">
            <div class="form-section-title"><span>ğŸ’°</span> ìš”ê¸ˆ ì •ë³´ (ì½ê¸° ì „ìš©)</div>
            <div class="form-row">
              <div class="form-group">
                <label>ìš´ì˜ì‹œê°„</label>
                <input type="text" id="f_operatingHours" readonly />
              </div>
              <div class="form-group">
                <label>ì‹œê°„ì œ ìš”ê¸ˆ</label>
                <input type="text" id="f_hourlyFee" readonly />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>ì›”ì •ê¸°ê¶Œ</label>
                <input type="text" id="f_monthlyPass" readonly />
              </div>
              <div class="form-group">
                <label>ë¹„ê³ </label>
                <input type="text" id="f_feeNote" readonly />
              </div>
            </div>
          </div>

          <div class="form-section">
            <div class="form-section-title"><span>ğŸ“</span> ì—ë””í† ë¦¬ì–¼ (í¸ì§‘ ê°€ëŠ¥)</div>
            <div class="form-group">
              <label>ì—ë””í„°ì˜ ì˜ê²¬</label>
              <textarea id="f_editorOpinion" placeholder="í˜„ì¥ ë°©ë¬¸ í›„ ëŠë‚€ ì , íŒ, íŠ¹ì´ì‚¬í•­ ë“±ì„ ììœ ë¡­ê²Œ ì‘ì„±í•˜ì„¸ìš”..."></textarea>
            </div>
            <div class="form-group">
              <label>ìµœì¢… ìˆ˜ì •ì¼</label>
              <input type="text" id="f_updatedAt" readonly />
            </div>
          </div>

          <div class="msg msg-success" id="saveSuccess">ì €ì¥ ì™„ë£Œ!</div>
          <div class="msg msg-error" id="saveError"></div>
        </div>

        <!-- ì‚¬ì§„ ê´€ë¦¬ íƒ­ -->
        <div class="tab-panel" id="tabPhotos">
          <div class="photo-drop" id="photoDrop">
            <div class="photo-drop-icon">ğŸ“¸</div>
            <div class="photo-drop-text">ì‚¬ì§„ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</div>
            <div class="photo-drop-sub">JPG, PNG, WebP â€” ìë™ìœ¼ë¡œ WebP ë³€í™˜ (ìµœëŒ€ 10ì¥)</div>
          </div>
          <input type="file" id="photoFileInput" accept="image/*" multiple style="display:none;" />
          <div class="msg msg-success photo-msg" id="photoSuccess"></div>
          <div class="msg msg-error photo-msg" id="photoError"></div>
          <div class="photo-grid" id="photoGrid"></div>
        </div>
      </div>
      <div class="modal-footer" id="formFooter">
        <button class="btn btn-gray" id="modalCloseFooter">ì·¨ì†Œ</button>
        <button class="btn btn-primary" id="saveFormBtn">ë…¸ì…˜ì— ì €ì¥</button>
      </div>
    </div>
  </div>

  <script is:inline>
    const districts = [
      'ê°•ë‚¨êµ¬','ê°•ë™êµ¬','ê°•ë¶êµ¬','ê°•ì„œêµ¬','ê´€ì•…êµ¬',
      'ê´‘ì§„êµ¬','êµ¬ë¡œêµ¬','ê¸ˆì²œêµ¬','ë…¸ì›êµ¬','ë„ë´‰êµ¬',
      'ë™ëŒ€ë¬¸êµ¬','ë™ì‘êµ¬','ë§ˆí¬êµ¬','ì„œëŒ€ë¬¸êµ¬','ì„œì´ˆêµ¬',
      'ì„±ë™êµ¬','ì„±ë¶êµ¬','ì†¡íŒŒêµ¬','ì–‘ì²œêµ¬','ì˜ë“±í¬êµ¬',
      'ìš©ì‚°êµ¬','ì€í‰êµ¬','ì¢…ë¡œêµ¬','ì¤‘êµ¬','ì¤‘ë‘êµ¬',
    ];

    let allParkingLots = [];
    let filteredParkingLots = [];
    let currentEditingParking = null;
    // êµ¬ë³„ ì›ë³¸ ê³µë‹¨ì£¼ì†Œ JSON ìºì‹œ (district â†’ { data, sha })
    let gongdanCache = {};
    // êµ¬ë³„ ë…¸ì…˜ ì—ë””í† ë¦¬ì–¼ ìºì‹œ (district â†’ { ì£¼ì°¨ì¥ëª…: editorial })
    let editorialCache = {};

    // â”€â”€â”€ ê³µë‹¨ì£¼ì†Œ JSONì—ì„œ ì£¼ì°¨ì¥ ëª©ë¡ ì¶”ì¶œ â”€â”€â”€
    function extractLotsFromGongdan(data) {
      const lots = [];
      const sources = [];
      // ë…¸ìƒì£¼ì°¨ì¥
      if (data.ë…¸ìƒì£¼ì°¨ì¥ && data.ë…¸ìƒì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡ && Array.isArray(data.ë…¸ìƒì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡))
        sources.push({ list: data.ë…¸ìƒì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡, cat: 'ë…¸ìƒ', path: ['ë…¸ìƒì£¼ì°¨ì¥','ì£¼ì°¨ì¥ëª©ë¡'] });
      else if (Array.isArray(data.ë…¸ìƒì£¼ì°¨ì¥))
        sources.push({ list: data.ë…¸ìƒì£¼ì°¨ì¥, cat: 'ë…¸ìƒ', path: ['ë…¸ìƒì£¼ì°¨ì¥'] });
      // ë…¸ì™¸ì£¼ì°¨ì¥
      if (data.ë…¸ì™¸ì£¼ì°¨ì¥ && data.ë…¸ì™¸ì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡ && Array.isArray(data.ë…¸ì™¸ì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡))
        sources.push({ list: data.ë…¸ì™¸ì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡, cat: 'ë…¸ì™¸', path: ['ë…¸ì™¸ì£¼ì°¨ì¥','ì£¼ì°¨ì¥ëª©ë¡'] });
      else if (Array.isArray(data.ë…¸ì™¸ì£¼ì°¨ì¥))
        sources.push({ list: data.ë…¸ì™¸ì£¼ì°¨ì¥, cat: 'ë…¸ì™¸', path: ['ë…¸ì™¸ì£¼ì°¨ì¥'] });
      // ë¶€ì„¤ì£¼ì°¨ì¥
      if (data.ë¶€ì„¤ì£¼ì°¨ì¥ && data.ë¶€ì„¤ì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡ && Array.isArray(data.ë¶€ì„¤ì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡))
        sources.push({ list: data.ë¶€ì„¤ì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡, cat: 'ë¶€ì„¤', path: ['ë¶€ì„¤ì£¼ì°¨ì¥','ì£¼ì°¨ì¥ëª©ë¡'] });
      else if (Array.isArray(data.ë¶€ì„¤ì£¼ì°¨ì¥))
        sources.push({ list: data.ë¶€ì„¤ì£¼ì°¨ì¥, cat: 'ë¶€ì„¤', path: ['ë¶€ì„¤ì£¼ì°¨ì¥'] });
      // ê³µì˜ì£¼ì°¨ì¥ ë˜í¼ (ê°•ë‚¨êµ¬ ë“±)
      const gp = data.ê³µì˜ì£¼ì°¨ì¥;
      if (gp) {
        if (gp.ë…¸ì™¸ì£¼ì°¨ì¥ && gp.ë…¸ì™¸ì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡ && Array.isArray(gp.ë…¸ì™¸ì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡))
          sources.push({ list: gp.ë…¸ì™¸ì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡, cat: 'ë…¸ì™¸', path: ['ê³µì˜ì£¼ì°¨ì¥','ë…¸ì™¸ì£¼ì°¨ì¥','ì£¼ì°¨ì¥ëª©ë¡'] });
        if (gp.ë…¸ìƒì£¼ì°¨ì¥ && gp.ë…¸ìƒì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡ && Array.isArray(gp.ë…¸ìƒì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡))
          sources.push({ list: gp.ë…¸ìƒì£¼ì°¨ì¥.ì£¼ì°¨ì¥ëª©ë¡, cat: 'ë…¸ìƒ', path: ['ê³µì˜ì£¼ì°¨ì¥','ë…¸ìƒì£¼ì°¨ì¥','ì£¼ì°¨ì¥ëª©ë¡'] });
        if (Array.isArray(gp.ë¶€ì„¤ì£¼ì°¨ì¥))
          sources.push({ list: gp.ë¶€ì„¤ì£¼ì°¨ì¥, cat: 'ë¶€ì„¤', path: ['ê³µì˜ì£¼ì°¨ì¥','ë¶€ì„¤ì£¼ì°¨ì¥'] });
        if (gp.ì£¼ì°¨ì¥ëª©ë¡) {
          var ml = gp.ì£¼ì°¨ì¥ëª©ë¡;
          if (Array.isArray(ml.ë…¸ì™¸ì£¼ì°¨ì¥))
            sources.push({ list: ml.ë…¸ì™¸ì£¼ì°¨ì¥, cat: 'ë…¸ì™¸', path: ['ê³µì˜ì£¼ì°¨ì¥','ì£¼ì°¨ì¥ëª©ë¡','ë…¸ì™¸ì£¼ì°¨ì¥'] });
          if (Array.isArray(ml.ë…¸ìƒì£¼ì°¨ì¥))
            sources.push({ list: ml.ë…¸ìƒì£¼ì°¨ì¥, cat: 'ë…¸ìƒ', path: ['ê³µì˜ì£¼ì°¨ì¥','ì£¼ì°¨ì¥ëª©ë¡','ë…¸ìƒì£¼ì°¨ì¥'] });
          if (Array.isArray(ml))
            sources.push({ list: ml, cat: 'ê³µì˜', path: ['ê³µì˜ì£¼ì°¨ì¥','ì£¼ì°¨ì¥ëª©ë¡'] });
        }
      }
      for (var s = 0; s < sources.length; s++) {
        var src = sources[s];
        for (var i = 0; i < src.list.length; i++) {
          var lot = src.list[i];
          if (typeof lot === 'object' && (lot.ì£¼ì°¨ì¥ëª… || lot.ì‹œì„¤ëª…)) {
            lots.push({ lot: lot, category: src.cat, path: src.path, index: i });
          }
        }
      }
      return lots;
    }

    // â”€â”€â”€ ìš”ê¸ˆì •ë³´ ë§¤ì¹­ â”€â”€â”€
    function findFeeInfo(data, lotName, category) {
      var norm = lotName.replace(/\s+/g, '').replace(/(ê³µì˜ì£¼ì°¨ì¥|ë…¸ìƒì£¼ì°¨ì¥|ë¶€ì„¤ì£¼ì°¨ì¥|ì£¼ì°¨ì¥|ê³µì˜)$/g, '').trim();
      var feeSources = [];
      if (data.ë…¸ìƒì£¼ì°¨ì¥ && data.ë…¸ìƒì£¼ì°¨ì¥.ìš”ê¸ˆì •ë³´) feeSources.push(data.ë…¸ìƒì£¼ì°¨ì¥.ìš”ê¸ˆì •ë³´);
      if (data.ë…¸ì™¸ì£¼ì°¨ì¥ && data.ë…¸ì™¸ì£¼ì°¨ì¥.ìš”ê¸ˆì •ë³´) feeSources.push(data.ë…¸ì™¸ì£¼ì°¨ì¥.ìš”ê¸ˆì •ë³´);
      if (data.ê³µì˜ì£¼ì°¨ì¥) {
        if (data.ê³µì˜ì£¼ì°¨ì¥.ë…¸ì™¸ì£¼ì°¨ì¥ && data.ê³µì˜ì£¼ì°¨ì¥.ë…¸ì™¸ì£¼ì°¨ì¥.ìš”ê¸ˆì •ë³´) feeSources.push(data.ê³µì˜ì£¼ì°¨ì¥.ë…¸ì™¸ì£¼ì°¨ì¥.ìš”ê¸ˆì •ë³´);
        if (data.ê³µì˜ì£¼ì°¨ì¥.ë…¸ìƒì£¼ì°¨ì¥ && data.ê³µì˜ì£¼ì°¨ì¥.ë…¸ìƒì£¼ì°¨ì¥.ìš”ê¸ˆì •ë³´) feeSources.push(data.ê³µì˜ì£¼ì°¨ì¥.ë…¸ìƒì£¼ì°¨ì¥.ìš”ê¸ˆì •ë³´);
      }
      for (var i = 0; i < feeSources.length; i++) {
        var fees = feeSources[i];
        if (!Array.isArray(fees)) continue;
        for (var j = 0; j < fees.length; j++) {
          var f = fees[j];
          var fNorm = (f.ì£¼ì°¨ì¥ëª… || '').replace(/\s+/g, '').replace(/(ê³µì˜ì£¼ì°¨ì¥|ë…¸ìƒì£¼ì°¨ì¥|ë¶€ì„¤ì£¼ì°¨ì¥|ì£¼ì°¨ì¥|ê³µì˜)$/g, '').trim();
          if (fNorm === norm) return f;
        }
      }
      return null;
    }

    // â”€â”€â”€ ë°ì´í„° ë¡œë”© â”€â”€â”€
    async function loadAllParkingData() {
      try {
        var promises = districts.map(function(d) {
          return fetch('/api/admin/parking/?district=' + encodeURIComponent(d))
            .then(function(res) { return res.json(); })
            .then(function(result) {
              if (result.error) return { district: d, data: null, sha: null };
              var parsed = JSON.parse(result.content);
              gongdanCache[d] = { data: parsed, sha: result.sha };
              return { district: d, data: parsed, sha: result.sha };
            })
            .catch(function() { return { district: d, data: null, sha: null }; });
        });
        var results = await Promise.all(promises);

        // ì—ë””í† ë¦¬ì–¼ ë³‘ë ¬ ë¡œë“œ (ë…¸ì…˜)
        var editorialPromises = districts.map(function(d) {
          return fetch('/api/admin/parking/?action=editorial&district=' + encodeURIComponent(d))
            .then(function(res) { return res.json(); })
            .then(function(result) {
              if (result.editorials) {
                var map = {};
                result.editorials.forEach(function(ed) { map[ed.parkingName] = ed; });
                editorialCache[d] = map;
              }
              return { district: d };
            })
            .catch(function() { return { district: d }; });
        });
        await Promise.all(editorialPromises);

        allParkingLots = [];
        results.forEach(function(r) {
          if (!r.data) return;
          var lots = extractLotsFromGongdan(r.data);
          lots.forEach(function(entry) {
            allParkingLots.push({
              district: r.district,
              lot: entry.lot,
              category: entry.category,
              path: entry.path,
              index: entry.index,
              fee: findFeeInfo(r.data, entry.lot.ì£¼ì°¨ì¥ëª… || entry.lot.ì‹œì„¤ëª… || '', entry.category),
            });
          });
        });

        document.getElementById('pageTitle').textContent = 'ì£¼ì°¨ì¥ ê´€ë¦¬ (ê³µë‹¨ì£¼ì†Œ)';
        document.getElementById('pageSubtitle').textContent = 'ì´ ' + allParkingLots.length + 'ê°œ ì£¼ì°¨ì¥';

        var districtFilter = document.getElementById('districtFilter');
        districts.forEach(function(d) {
          var opt = document.createElement('option');
          opt.value = d; opt.textContent = d;
          districtFilter.appendChild(opt);
        });

        applyFilters();
      } catch (e) {
        document.getElementById('loadingState').innerHTML = '<div style="color:#dc2626;">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ' + e.message + '</div>';
      }
    }

    // â”€â”€â”€ í•„í„° â”€â”€â”€
    function applyFilters() {
      var search = document.getElementById('searchInput').value.toLowerCase();
      var dist = document.getElementById('districtFilter').value;
      var type = document.getElementById('typeFilter').value;

      filteredParkingLots = allParkingLots.filter(function(entry) {
        var name = (entry.lot.ì£¼ì°¨ì¥ëª… || entry.lot.ì‹œì„¤ëª… || '').toLowerCase();
        var addr = (entry.lot.ì†Œì¬ì§€ || entry.lot.ìœ„ì¹˜ || entry.lot.ì£¼ì†Œ || '').toLowerCase();
        var matchSearch = !search || name.includes(search) || addr.includes(search);
        var matchDist = !dist || entry.district === dist;
        var matchType = !type || entry.category === type;
        return matchSearch && matchDist && matchType;
      });

      renderTable();
    }

    // â”€â”€â”€ í…Œì´ë¸” ë Œë”ë§ â”€â”€â”€
    function renderTable() {
      var loadingEl = document.getElementById('loadingState');
      var emptyEl = document.getElementById('emptyState');
      var table = document.getElementById('parkingTable');
      var tbody = document.getElementById('parkingTableBody');

      loadingEl.style.display = 'none';

      if (filteredParkingLots.length === 0) {
        emptyEl.style.display = 'block';
        table.style.display = 'none';
        return;
      }

      emptyEl.style.display = 'none';
      table.style.display = 'table';

      tbody.innerHTML = filteredParkingLots.map(function(entry, idx) {
        var lot = entry.lot;
        var name = lot.ì£¼ì°¨ì¥ëª… || lot.ì‹œì„¤ëª… || '(ì´ë¦„ì—†ìŒ)';
        var addr = lot.ì†Œì¬ì§€ || lot.ìœ„ì¹˜ || lot.ì£¼ì†Œ || '';
        var edMap = editorialCache[entry.district] || {};
        var hasEd = edMap[name] && edMap[name].editorOpinion;
        var edDot = hasEd ? '<span class="has-editorial" title="ì—ë””í† ë¦¬ì–¼ ìˆìŒ"></span>' : '';

        return '<tr onclick="openEditor(' + idx + ')">' +
          '<td>' + entry.district + '</td>' +
          '<td><div class="parking-name">' + name + edDot + '</div><div class="parking-addr">' + addr + '</div></td>' +
          '<td><span class="badge badge-' + entry.category + '">' + entry.category + '</span></td>' +
          '<td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">' + addr + '</td>' +
          '<td><div class="td-actions"><button class="btn btn-primary" style="padding:4px 10px;font-size:11px;" onclick="event.stopPropagation();openEditor(' + idx + ')">í¸ì§‘</button></div></td>' +
        '</tr>';
      }).join('');
    }

    // â”€â”€â”€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ â”€â”€â”€
    document.getElementById('searchInput').addEventListener('input', applyFilters);
    document.getElementById('districtFilter').addEventListener('change', applyFilters);
    document.getElementById('typeFilter').addEventListener('change', applyFilters);

    // â”€â”€â”€ ëª¨ë‹¬ íƒ­ ì „í™˜ â”€â”€â”€
    document.querySelector('.modal-tabs').addEventListener('click', function(e) {
      var tab = e.target.closest('.modal-tab');
      if (!tab) return;
      var tabName = tab.dataset.tab;

      document.querySelectorAll('.modal-tab').forEach(function(t) { t.classList.remove('active'); });
      tab.classList.add('active');

      document.querySelectorAll('.tab-panel').forEach(function(p) { p.classList.remove('active'); });
      document.getElementById(tabName === 'form' ? 'tabForm' : 'tabPhotos').classList.add('active');

      document.getElementById('formFooter').style.display = tabName === 'form' ? 'flex' : 'none';

      if (tabName === 'photos' && currentEditingParking) {
        loadPhotos();
      }
    });

    // â”€â”€â”€ ëª¨ë‹¬ ì—´ê¸° â”€â”€â”€
    window.openEditor = function(filteredIdx) {
      var entry = filteredParkingLots[filteredIdx];
      if (!entry) return;

      var lot = entry.lot;
      var fee = entry.fee;
      currentEditingParking = {
        district: entry.district,
        lot: lot,
        category: entry.category,
        path: entry.path,
        index: entry.index,
        fee: fee,
        filteredIdx: filteredIdx,
      };

      var name = lot.ì£¼ì°¨ì¥ëª… || lot.ì‹œì„¤ëª… || '';
      var addr = lot.ì†Œì¬ì§€ || lot.ìœ„ì¹˜ || lot.ì£¼ì†Œ || '';

      document.getElementById('modalTitle').textContent = name;
      document.getElementById('modalSubtitle').textContent = entry.district + ' Â· ' + entry.category + ' Â· ' + addr;
      document.getElementById('modalOverlay').style.display = 'block';
      document.getElementById('saveSuccess').style.display = 'none';
      document.getElementById('saveError').style.display = 'none';
      document.getElementById('photoSuccess').style.display = 'none';
      document.getElementById('photoError').style.display = 'none';

      // íƒ­ ì´ˆê¸°í™”
      document.querySelectorAll('.modal-tab').forEach(function(t) { t.classList.remove('active'); });
      document.querySelector('.modal-tab[data-tab="form"]').classList.add('active');
      document.querySelectorAll('.tab-panel').forEach(function(p) { p.classList.remove('active'); });
      document.getElementById('tabForm').classList.add('active');
      document.getElementById('formFooter').style.display = 'flex';

      // ì‚¬ì§„ ê°œìˆ˜
      document.getElementById('photoCount').textContent = '0';

      // ì½ê¸° ì „ìš© í•„ë“œ ì±„ìš°ê¸°
      document.getElementById('f_name').value = name;
      document.getElementById('f_category').value = entry.category;
      document.getElementById('f_spaces').value = lot.êµ¬íšìˆ˜ || lot.êµ¬íš || lot.ë©´ìˆ˜ || '';
      document.getElementById('f_grade').value = lot.ê¸‰ì§€ || '';
      document.getElementById('f_address').value = addr;
      document.getElementById('f_area').value = lot.ë©´ì  || '';
      document.getElementById('f_transferDate').value = lot.ì¸ìˆ˜ì¼ || '';

      // ìš”ê¸ˆ ì •ë³´
      if (fee) {
        document.getElementById('f_operatingHours').value = fee.ìš´ì˜ì‹œê°„ || '';
        document.getElementById('f_hourlyFee').value = fee.ì‹œê°„ì œìš”ê¸ˆ || fee['ì‹œê°„ì£¼ì°¨(5ë¶„ë‹¹)'] || fee.ì‹œê°„ì£¼ì°¨ìš”ê¸ˆ || fee.ìš”ê¸ˆ_5ë¶„ë‹¹ || '';
        document.getElementById('f_monthlyPass').value = fee.ì›”ì •ê¸°ê¶Œ || fee.ì›”ì •ê¸°ìš”ê¸ˆ || fee.ì›”ì •ê¸°_ì£¼ê°„ || fee.ì›”ì •ê¸° || '';
        document.getElementById('f_feeNote').value = fee.ë¹„ê³  || '';
      } else {
        document.getElementById('f_operatingHours').value = '';
        document.getElementById('f_hourlyFee').value = '';
        document.getElementById('f_monthlyPass').value = '';
        document.getElementById('f_feeNote').value = '';
      }

      // ì—ë””í† ë¦¬ì–¼ í•„ë“œ (ë…¸ì…˜ì—ì„œ ë¡œë“œ)
      var edMap = editorialCache[entry.district] || {};
      var ed = edMap[name] || {};
      document.getElementById('f_editorOpinion').value = ed.editorOpinion || '';
      document.getElementById('f_updatedAt').value = ed.updatedAt || '';

      // ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ
      document.querySelector('.modal-body').scrollTop = 0;
    };

    // â”€â”€â”€ ëª¨ë‹¬ ë‹«ê¸° â”€â”€â”€
    function closeModal() {
      document.getElementById('modalOverlay').style.display = 'none';
    }
    document.getElementById('modalClose').addEventListener('click', closeModal);
    document.getElementById('modalCloseFooter').addEventListener('click', closeModal);
    document.getElementById('modalOverlay').addEventListener('click', function(e) {
      if (e.target === document.getElementById('modalOverlay')) closeModal();
    });

    // â”€â”€â”€ í¼ ì €ì¥ (editorial í•„ë“œë§Œ) â”€â”€â”€
    document.getElementById('saveFormBtn').addEventListener('click', async function() {
      if (!currentEditingParking) return;

      var btn = document.getElementById('saveFormBtn');
      var okMsg = document.getElementById('saveSuccess');
      var errMsg = document.getElementById('saveError');
      btn.disabled = true; btn.textContent = 'ì €ì¥ ì¤‘...';
      okMsg.style.display = 'none'; errMsg.style.display = 'none';

      var editorOpinion = document.getElementById('f_editorOpinion').value.trim();

      try {
        var district = currentEditingParking.district;
        var name = currentEditingParking.lot.ì£¼ì°¨ì¥ëª… || currentEditingParking.lot.ì‹œì„¤ëª… || '';
        var category = currentEditingParking.category;

        // ë…¸ì…˜ì— POSTë¡œ ì €ì¥
        var saveRes = await fetch('/api/admin/parking/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            parkingName: name,
            district: district,
            category: category,
            editorOpinion: editorOpinion,
          }),
        });

        var saveResult = await saveRes.json();

        if (saveRes.ok) {
          okMsg.textContent = 'ë…¸ì…˜ì— ì €ì¥ ì™„ë£Œ!';
          okMsg.style.display = 'block';

          // ë¡œì»¬ ì—ë””í† ë¦¬ì–¼ ìºì‹œë„ ì—…ë°ì´íŠ¸
          var today = new Date().toISOString().slice(0, 10);
          if (!editorialCache[district]) editorialCache[district] = {};
          editorialCache[district][name] = {
            parkingName: name,
            district: district,
            category: category,
            editorOpinion: editorOpinion,
            updatedAt: today,
          };
          document.getElementById('f_updatedAt').value = today;
          applyFilters();
        } else {
          errMsg.textContent = saveResult.error || 'ì €ì¥ ì‹¤íŒ¨';
          errMsg.style.display = 'block';
        }
      } catch (e) {
        errMsg.textContent = 'ì„œë²„ ì˜¤ë¥˜: ' + e.message;
        errMsg.style.display = 'block';
      } finally {
        btn.disabled = false; btn.textContent = 'ë…¸ì…˜ì— ì €ì¥';
      }
    });

    // â”€â”€â”€ ì‚¬ì§„ ê´€ë¦¬ â”€â”€â”€
    let currentPhotos = [];

    async function loadPhotos() {
      const grid = document.getElementById('photoGrid');
      grid.innerHTML = '<div style="text-align:center;padding:20px;color:#94a3b8;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

      const { district, lot } = currentEditingParking;
      const slug = lot.slug;

      if (!slug) {
        grid.innerHTML = '<div style="text-align:center;padding:20px;color:#94a3b8;">ì´ ì£¼ì°¨ì¥ì—ëŠ” ì•„ì§ slugê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      try {
        const res = await fetch('/api/admin/parking-images/?district=' + encodeURIComponent(district) + '&slug=' + encodeURIComponent(slug));
        const data = await res.json();
        currentPhotos = data.images || [];
        document.getElementById('photoCount').textContent = currentPhotos.length;
        renderPhotos();
      } catch (e) {
        grid.innerHTML = '<div style="text-align:center;padding:20px;color:#dc2626;">ë¡œë”© ì‹¤íŒ¨: ' + e.message + '</div>';
      }
    }

    function renderPhotos() {
      const grid = document.getElementById('photoGrid');
      if (currentPhotos.length === 0) {
        grid.innerHTML = '<div style="text-align:center;padding:24px;color:#94a3b8;font-size:13px;">ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      grid.innerHTML = currentPhotos.map((photo, i) =>
        '<div class="photo-item" data-index="' + i + '">' +
          '<img src="' + photo.url + '" alt="' + photo.name + '" loading="lazy" />' +
          '<button class="photo-delete" onclick="deletePhoto(' + i + ')" title="ì‚­ì œ">Ã—</button>' +
          '<div class="photo-name">' + photo.name + '</div>' +
        '</div>'
      ).join('');
    }

    // ë“œë˜ê·¸ ì•¤ ë“œë¡­
    const dropZone = document.getElementById('photoDrop');
    const fileInput = document.getElementById('photoFileInput');

    dropZone.addEventListener('click', () => fileInput.click());
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
    dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.classList.remove('dragover'); handleFiles(e.dataTransfer.files); });
    fileInput.addEventListener('change', (e) => { handleFiles(e.target.files); fileInput.value = ''; });

    async function handleFiles(files) {
      if (!currentEditingParking) return;
      const { district, lot } = currentEditingParking;
      const slug = lot.slug;

      if (!slug) { showPhotoError('slugê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }

      const remaining = 10 - currentPhotos.length;
      const filesToProcess = Array.from(files).slice(0, remaining);
      if (filesToProcess.length === 0) { showPhotoError('ìµœëŒ€ 10ì¥ê¹Œì§€ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'); return; }

      showPhotoSuccess(filesToProcess.length + 'ì¥ ì—…ë¡œë“œ ì¤‘...');

      for (const file of filesToProcess) {
        try {
          const base64 = await convertToWebP(file);
          const nextNum = getNextFileName();
          const fileName = nextNum + '.webp';

          const res = await fetch('/api/admin/parking-images/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ district, slug, fileName, base64Data: base64 }),
          });

          const result = await res.json();
          if (!res.ok) throw new Error(result.error);
          showPhotoSuccess(fileName + ' ì—…ë¡œë“œ ì™„ë£Œ!');
        } catch (e) { showPhotoError('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + e.message); }
      }

      await loadPhotos();
      showPhotoSuccess('ëª¨ë“  ì‚¬ì§„ ì—…ë¡œë“œ ì™„ë£Œ!');
    }

    function getNextFileName() {
      const nums = currentPhotos.map(p => parseInt(p.name.replace('.webp', ''), 10)).filter(n => !isNaN(n));
      let next = 1;
      while (nums.includes(next)) next++;
      return String(next).padStart(2, '0');
    }

    function convertToWebP(file) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        const reader = new FileReader();
        reader.onload = (e) => {
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const maxSize = 1200;
            let w = img.width, h = img.height;
            if (w > maxSize || h > maxSize) {
              if (w > h) { h = Math.round(h * maxSize / w); w = maxSize; }
              else { w = Math.round(w * maxSize / h); h = maxSize; }
            }
            canvas.width = w; canvas.height = h;
            canvas.getContext('2d').drawImage(img, 0, 0, w, h);
            resolve(canvas.toDataURL('image/webp', 0.8).split(',')[1]);
          };
          img.onerror = () => reject(new Error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨'));
          img.src = e.target.result;
        };
        reader.onerror = () => reject(new Error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨'));
        reader.readAsDataURL(file);
      });
    }

    window.deletePhoto = async function(index) {
      const photo = currentPhotos[index];
      if (!photo || !confirm('"' + photo.name + '" ì‚¬ì§„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      const { district, lot } = currentEditingParking;
      try {
        const res = await fetch('/api/admin/parking-images/', {
          method: 'DELETE',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ district, slug: lot.slug, fileName: photo.name, sha: photo.sha }),
        });
        const result = await res.json();
        if (!res.ok) throw new Error(result.error);
        showPhotoSuccess(photo.name + ' ì‚­ì œ ì™„ë£Œ!');
        await loadPhotos();
      } catch (e) { showPhotoError('ì‚­ì œ ì‹¤íŒ¨: ' + e.message); }
    };

    function showPhotoSuccess(msg) {
      const el = document.getElementById('photoSuccess');
      el.textContent = msg; el.style.display = 'block';
      document.getElementById('photoError').style.display = 'none';
    }
    function showPhotoError(msg) {
      const el = document.getElementById('photoError');
      el.textContent = msg; el.style.display = 'block';
      document.getElementById('photoSuccess').style.display = 'none';
    }

    // â”€â”€â”€ ë¡œê·¸ì•„ì›ƒ â”€â”€â”€
    document.getElementById('logoutBtn').addEventListener('click', async () => {
      await fetch('/api/auth/logout/', { method: 'POST' });
      window.location.href = '/admin/login/';
    });

    // í˜ì´ì§€ ë¡œë“œ
    loadAllParkingData();
  </script>
</body>
</html>
