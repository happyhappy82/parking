---
export const prerender = false;
---
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <title>ìƒˆ ë¸”ë¡œê·¸ ê¸€ ì‘ì„± | ParkingMap Admin</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f1f5f9;color:#1e293b;-webkit-font-smoothing:antialiased}

    .sidebar{position:fixed;top:0;left:0;width:220px;height:100vh;background:#0f172a;display:flex;flex-direction:column;z-index:50}
    .sidebar-header{padding:20px;border-bottom:1px solid rgba(255,255,255,.06)}
    .sidebar-logo{font-size:15px;font-weight:800;color:#e2e8f0;display:flex;align-items:center;gap:10px;text-decoration:none}
    .logo-icon{width:30px;height:30px;background:linear-gradient(135deg,#10b981,#059669);border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;font-weight:900;font-size:15px}
    .sidebar nav{flex:1;padding:16px 0}
    .sidebar nav a{display:flex;align-items:center;gap:10px;padding:10px 16px;margin:2px 8px;color:#94a3b8;text-decoration:none;font-size:13px;font-weight:500;border-radius:8px;transition:all .15s}
    .sidebar nav a:hover{color:#e2e8f0;background:rgba(255,255,255,.05)}
    .sidebar nav a.active{color:white;background:rgba(16,185,129,.15)}
    .nav-icon{font-size:16px;width:20px;text-align:center}
    .sidebar-footer{padding:16px 20px;border-top:1px solid rgba(255,255,255,.06)}
    .logout-btn{width:100%;padding:8px 12px;background:transparent;border:1px solid rgba(255,255,255,.1);color:#64748b;border-radius:6px;font-size:12px;cursor:pointer;transition:all .15s}
    .logout-btn:hover{background:rgba(255,255,255,.05);color:#94a3b8}

    .main{margin-left:220px;padding:28px 32px;max-width:960px}
    .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
    .page-header h1{font-size:22px;font-weight:800;color:#0f172a}
    .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;transition:all .15s;text-decoration:none}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn-primary{background:#10b981;color:white}
    .btn-primary:hover{background:#059669}
    .btn-back{background:#e2e8f0;color:#475569}
    .btn-back:hover{background:#cbd5e1}

    .edit-card{background:white;border-radius:12px;padding:24px;border:1px solid #e2e8f0}
    .form-group{margin-bottom:16px}
    .form-group label{display:block;font-size:12px;font-weight:600;color:#64748b;margin-bottom:6px;text-transform:uppercase;letter-spacing:.04em}
    .form-group input,.form-group textarea,.form-group select{width:100%;padding:9px 12px;border:1px solid #e2e8f0;border-radius:8px;font-size:13px;color:#1e293b;outline:none;font-family:inherit;transition:all .15s;background:white}
    .form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,.1)}
    .form-group textarea{min-height:400px;font-family:'SF Mono','Fira Code',monospace;font-size:13px;line-height:1.6;resize:vertical}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .actions{display:flex;gap:10px;margin-top:20px}
    .msg{padding:10px 14px;border-radius:8px;font-size:13px;margin-top:12px;display:none}
    .msg-success{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0}
    .msg-error{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}
    .slug-preview{font-size:11px;color:#94a3b8;margin-top:4px;font-family:'SF Mono','Fira Code',monospace}
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="sidebar-header">
      <a href="/admin/parking/" class="sidebar-logo">
        <div class="logo-icon">P</div>
        ParkingMap
      </a>
    </div>
    <nav>
      <a href="/admin/parking/"><span class="nav-icon">ğŸ…¿ï¸</span> ì£¼ì°¨ì¥ ê´€ë¦¬</a>
      <a href="/admin/blog/" class="active"><span class="nav-icon">ğŸ“</span> ë¸”ë¡œê·¸ ê´€ë¦¬</a>
    </nav>
    <div class="sidebar-footer">
      <button class="logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </aside>

  <div class="main">
    <div class="page-header">
      <h1>ìƒˆ ë¸”ë¡œê·¸ ê¸€ ì‘ì„±</h1>
      <a href="/admin/blog/" class="btn btn-back">â† ëª©ë¡ìœ¼ë¡œ</a>
    </div>

    <div class="edit-card">
      <form id="blogForm">
        <div class="form-group">
          <label>ì œëª©</label>
          <input type="text" id="title" placeholder="ë¸”ë¡œê·¸ ê¸€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>ìŠ¬ëŸ¬ê·¸ (URL)</label>
            <input type="text" id="slug" placeholder="my-blog-post" required />
            <div class="slug-preview">ë¯¸ë¦¬ë³´ê¸°: /blog/<span id="slugPreview">-</span>/</div>
          </div>
          <div class="form-group">
            <label>ë‚ ì§œ</label>
            <input type="date" id="date" required />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>ì¹´í…Œê³ ë¦¬</label>
            <select id="category" style="cursor:pointer;">
              <option value="ë¸”ë¡œê·¸">ë¸”ë¡œê·¸</option>
              <option value="ì£¼ì°¨ì¥">ì£¼ì°¨ì¥</option>
            </select>
          </div>
          <div class="form-group">
            <label>ì§§ì€ ì´ë¦„ (ì„ íƒ)</label>
            <input type="text" id="breadcrumbName" placeholder="ë¹µê°€ë£¨ í‘œì‹œìš© ì§§ì€ ì´ë¦„" />
          </div>
        </div>
        <div class="form-group">
          <label>ì„¤ëª… (SEO)</label>
          <input type="text" id="description" placeholder="ê²€ìƒ‰ ê²°ê³¼ì— í‘œì‹œë  ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required />
        </div>
        <div class="form-group">
          <label>ë³¸ë¬¸ (Markdown)</label>
          <textarea id="content" placeholder="ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ë³¸ë¬¸ì„ ì‘ì„±í•˜ì„¸ìš”..." required></textarea>
        </div>
        <div class="actions">
          <button type="submit" class="btn btn-primary" id="saveBtn">GitHubì— ì €ì¥</button>
        </div>
        <div class="msg msg-success" id="successMsg"></div>
        <div class="msg msg-error" id="errorMsg"></div>
      </form>
    </div>
  </div>

  <script is:inline>
    document.getElementById('date').value = new Date().toISOString().split('T')[0];

    document.getElementById('title').addEventListener('input', (e) => {
      const slug = e.target.value.toLowerCase().replace(/[ê°€-í£]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'');
      if (!document.getElementById('slug').dataset.manual) {
        document.getElementById('slug').value = slug;
        document.getElementById('slugPreview').textContent = slug || '-';
      }
    });

    document.getElementById('slug').addEventListener('input', (e) => {
      e.target.dataset.manual = 'true';
      document.getElementById('slugPreview').textContent = e.target.value || '-';
    });

    document.getElementById('blogForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('saveBtn');
      const successMsg = document.getElementById('successMsg');
      const errorMsg = document.getElementById('errorMsg');
      btn.disabled = true; btn.textContent = 'ì €ì¥ ì¤‘...';
      successMsg.style.display = 'none'; errorMsg.style.display = 'none';
      const data = {
        title: document.getElementById('title').value,
        slug: document.getElementById('slug').value,
        date: document.getElementById('date').value,
        description: document.getElementById('description').value,
        content: document.getElementById('content').value,
        category: document.getElementById('category').value,
        breadcrumbName: document.getElementById('breadcrumbName').value || undefined,
      };
      try {
        const res = await fetch('/api/admin/blog/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });
        const result = await res.json();
        if (res.ok) { successMsg.textContent = 'ì €ì¥ ì™„ë£Œ! Vercel ìë™ ë°°í¬ê°€ ì‹œì‘ë©ë‹ˆë‹¤.'; successMsg.style.display = 'block'; }
        else { errorMsg.textContent = result.error || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'; errorMsg.style.display = 'block'; }
      } catch (err) { errorMsg.textContent = 'ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ' + err.message; errorMsg.style.display = 'block'; }
      finally { btn.disabled = false; btn.textContent = 'GitHubì— ì €ì¥'; }
    });

    document.getElementById('logoutBtn').addEventListener('click', async () => {
      await fetch('/api/auth/logout/', { method: 'POST' });
      window.location.href = '/admin/login/';
    });
  </script>
</body>
</html>
