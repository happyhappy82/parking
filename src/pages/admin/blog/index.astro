---
export const prerender = false;
---
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <title>ë¸”ë¡œê·¸ ê´€ë¦¬ | ParkingMap Admin</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f1f5f9;color:#1e293b;-webkit-font-smoothing:antialiased}

    /* â”€â”€ Sidebar â”€â”€ */
    .sidebar{position:fixed;top:0;left:0;width:220px;height:100vh;background:#0f172a;display:flex;flex-direction:column;z-index:50}
    .sidebar-header{padding:20px;border-bottom:1px solid rgba(255,255,255,.06)}
    .sidebar-logo{font-size:15px;font-weight:800;color:#e2e8f0;display:flex;align-items:center;gap:10px;text-decoration:none}
    .logo-icon{width:30px;height:30px;background:linear-gradient(135deg,#10b981,#059669);border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;font-weight:900;font-size:15px}
    .sidebar nav{flex:1;padding:16px 0}
    .sidebar nav a{display:flex;align-items:center;gap:10px;padding:10px 16px;margin:2px 8px;color:#94a3b8;text-decoration:none;font-size:13px;font-weight:500;border-radius:8px;transition:all .15s}
    .sidebar nav a:hover{color:#e2e8f0;background:rgba(255,255,255,.05)}
    .sidebar nav a.active{color:white;background:rgba(16,185,129,.15)}
    .nav-icon{font-size:16px;width:20px;text-align:center}
    .sidebar-footer{padding:16px 20px;border-top:1px solid rgba(255,255,255,.06)}
    .logout-btn{width:100%;padding:8px 12px;background:transparent;border:1px solid rgba(255,255,255,.1);color:#64748b;border-radius:6px;font-size:12px;cursor:pointer;transition:all .15s}
    .logout-btn:hover{background:rgba(255,255,255,.05);color:#94a3b8}

    /* â”€â”€ Main â”€â”€ */
    .main{margin-left:220px;padding:28px 32px;min-height:100vh}
    .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
    .page-header h1{font-size:22px;font-weight:800;color:#0f172a}
    .page-header .subtitle{font-size:13px;color:#64748b;margin-top:2px}
    .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;text-decoration:none;transition:all .15s;white-space:nowrap}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn-primary{background:#10b981;color:white}
    .btn-primary:hover{background:#059669}
    .btn-edit{background:#3b82f6;color:white;padding:5px 12px;font-size:12px}
    .btn-edit:hover{background:#2563eb}
    .btn-view{background:#f1f5f9;color:#475569;padding:5px 12px;font-size:12px;border:1px solid #e2e8f0}
    .btn-view:hover{background:#e2e8f0}

    /* â”€â”€ Tabs â”€â”€ */
    .tabs{display:flex;gap:2px;margin-bottom:20px;background:#e2e8f0;border-radius:10px;padding:3px;width:fit-content}
    .tab{padding:8px 20px;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;background:transparent;color:#64748b;transition:all .15s}
    .tab:hover{color:#1e293b}
    .tab.active{background:white;color:#10b981;box-shadow:0 1px 3px rgba(0,0,0,.08)}
    .tab .count{display:inline-block;margin-left:5px;padding:1px 7px;border-radius:10px;font-size:11px;font-weight:700;background:rgba(100,116,139,.12);color:#64748b}
    .tab.active .count{background:rgba(16,185,129,.12);color:#10b981}

    /* â”€â”€ Table â”€â”€ */
    .table-card{background:white;border-radius:12px;overflow:hidden;border:1px solid #e2e8f0}
    table{width:100%;border-collapse:collapse}
    thead th{text-align:left;padding:12px 16px;font-size:11px;font-weight:700;color:#64748b;text-transform:uppercase;letter-spacing:.05em;background:#f8fafc;border-bottom:1px solid #e2e8f0}
    tbody td{padding:14px 16px;font-size:13px;border-bottom:1px solid #f1f5f9}
    tbody tr:hover{background:#f8fafc}
    tbody tr:last-child td{border-bottom:none}
    .post-title{font-weight:600;color:#0f172a;font-size:14px}
    .post-desc{font-size:11px;color:#94a3b8;margin-top:3px}
    .post-date{font-size:12px;color:#64748b;white-space:nowrap}
    .badge{display:inline-block;padding:2px 8px;border-radius:5px;font-size:10px;font-weight:700;letter-spacing:.02em}
    .badge-astro{background:#ede9fe;color:#7c3aed}
    .badge-md{background:#ecfdf5;color:#059669}
    .badge-blog{background:#dbeafe;color:#2563eb}
    .badge-parking{background:#fef3c7;color:#d97706}
    .actions{display:flex;gap:6px}
    .empty{text-align:center;padding:48px;color:#94a3b8;font-size:14px}
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="sidebar-header">
      <a href="/admin/parking/" class="sidebar-logo">
        <div class="logo-icon">P</div>
        ParkingMap
      </a>
    </div>
    <nav>
      <a href="/admin/parking/"><span class="nav-icon">ğŸ…¿ï¸</span> ì£¼ì°¨ì¥ ê´€ë¦¬</a>
      <a href="/admin/blog/" class="active"><span class="nav-icon">ğŸ“</span> ë¸”ë¡œê·¸ ê´€ë¦¬</a>
    </nav>
    <div class="sidebar-footer">
      <button class="logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </aside>

  <div class="main">
    <div class="page-header">
      <div>
        <h1>ë¸”ë¡œê·¸ ê´€ë¦¬</h1>
        <p class="subtitle" id="postCount">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
      <a href="/admin/blog/new/" class="btn btn-primary">+ ìƒˆ ê¸€ ì‘ì„±</a>
    </div>

    <div class="tabs" id="categoryTabs">
      <button class="tab active" data-category="all">ì „ì²´ <span class="count" id="countAll">0</span></button>
      <button class="tab" data-category="ë¸”ë¡œê·¸">ë¸”ë¡œê·¸ <span class="count" id="countBlog">0</span></button>
      <button class="tab" data-category="ì£¼ì°¨ì¥">ì£¼ì°¨ì¥ <span class="count" id="countParking">0</span></button>
    </div>

    <div class="table-card">
      <table>
        <thead>
          <tr>
            <th>ì œëª©</th>
            <th>ì¹´í…Œê³ ë¦¬</th>
            <th>ìœ í˜•</th>
            <th>ë‚ ì§œ</th>
            <th style="width:180px">ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody id="postBody">
          <tr><td colspan="5" class="empty">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script is:inline>
    let allPosts = [];
    let currentCategory = 'all';

    async function loadPosts() {
      const tbody = document.getElementById('postBody');
      const countEl = document.getElementById('postCount');
      try {
        const res = await fetch('/api/admin/blog/');
        const data = await res.json();
        if (!data.posts || data.posts.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" class="empty">ë¸”ë¡œê·¸ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          countEl.textContent = 'ì´ 0ê°œ';
          return;
        }
        allPosts = data.posts;
        updateCounts();
        renderPosts();
      } catch (e) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty">ë¡œë“œ ì‹¤íŒ¨: ' + e.message + '</td></tr>';
      }
    }

    function updateCounts() {
      const blogCount = allPosts.filter(p => (p.category || 'ë¸”ë¡œê·¸') === 'ë¸”ë¡œê·¸').length;
      const parkingCount = allPosts.filter(p => p.category === 'ì£¼ì°¨ì¥').length;
      document.getElementById('countAll').textContent = allPosts.length;
      document.getElementById('countBlog').textContent = blogCount;
      document.getElementById('countParking').textContent = parkingCount;
      document.getElementById('postCount').textContent = 'ì´ ' + allPosts.length + 'ê°œ';
    }

    function renderPosts() {
      const tbody = document.getElementById('postBody');
      const filtered = currentCategory === 'all'
        ? allPosts
        : allPosts.filter(p => (p.category || 'ë¸”ë¡œê·¸') === currentCategory);

      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty">í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }

      tbody.innerHTML = filtered.map(post => {
        const isLegacy = post.source === 'legacy';
        const isParkingEditorial = post.source === 'parking-editorial';
        const badgeClass = isLegacy ? 'badge-astro' : 'badge-md';
        const badgeText = isLegacy ? 'Astro' : 'MD';
        const editUrl = isLegacy
          ? '/admin/blog/edit/?slug=' + post.slug + '&type=legacy'
          : isParkingEditorial
            ? '/admin/blog/edit/?slug=' + post.slug + '&type=parking-editorial'
            : '/admin/blog/edit/?slug=' + post.slug;
        const cat = post.category || 'ë¸”ë¡œê·¸';
        const catClass = cat === 'ì£¼ì°¨ì¥' ? 'badge-parking' : 'badge-blog';

        let viewUrl = '/blog/' + post.slug + '/';
        let displayPath = '/blog/' + post.slug + '/';
        if (isParkingEditorial && post.sido && post.sigungu && post.dong && post.parkingSlug) {
          viewUrl = '/' + encodeURIComponent(post.sido) + '/' + encodeURIComponent(post.sigungu) + '/' + encodeURIComponent(post.dong) + '/' + encodeURIComponent(post.parkingSlug) + '/';
          displayPath = '/' + post.sido + '/' + post.sigungu + '/' + post.dong + '/' + post.parkingSlug + '/';
        }

        return '<tr>' +
          '<td><div class="post-title">' + post.title + '</div><div class="post-desc">' + displayPath + '</div></td>' +
          '<td><span class="badge ' + catClass + '">' + cat + '</span></td>' +
          '<td><span class="badge ' + badgeClass + '">' + badgeText + '</span></td>' +
          '<td class="post-date">' + post.date + '</td>' +
          '<td><div class="actions">' +
            '<a href="' + editUrl + '" class="btn btn-edit">í¸ì§‘</a>' +
            '<a href="' + viewUrl + '" target="_blank" class="btn btn-view">ì‚¬ì´íŠ¸ì—ì„œ ë³´ê¸° â†—</a>' +
          '</div></td>' +
        '</tr>';
      }).join('');
    }

    document.getElementById('categoryTabs').addEventListener('click', (e) => {
      const tab = e.target.closest('.tab');
      if (!tab) return;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      currentCategory = tab.dataset.category;
      renderPosts();
    });

    document.getElementById('logoutBtn').addEventListener('click', async () => {
      await fetch('/api/auth/logout/', { method: 'POST' });
      window.location.href = '/admin/login/';
    });

    loadPosts();
  </script>
</body>
</html>
