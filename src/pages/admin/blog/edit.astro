---
export const prerender = false;
---
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <title>ë¸”ë¡œê·¸ ê¸€ í¸ì§‘ | ParkingMap Admin</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f1f5f9;color:#1e293b;-webkit-font-smoothing:antialiased}

    .sidebar{position:fixed;top:0;left:0;width:220px;height:100vh;background:#0f172a;display:flex;flex-direction:column;z-index:50}
    .sidebar-header{padding:20px;border-bottom:1px solid rgba(255,255,255,.06)}
    .sidebar-logo{font-size:15px;font-weight:800;color:#e2e8f0;display:flex;align-items:center;gap:10px;text-decoration:none}
    .logo-icon{width:30px;height:30px;background:linear-gradient(135deg,#10b981,#059669);border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;font-weight:900;font-size:15px}
    .sidebar nav{flex:1;padding:16px 0}
    .sidebar nav a{display:flex;align-items:center;gap:10px;padding:10px 16px;margin:2px 8px;color:#94a3b8;text-decoration:none;font-size:13px;font-weight:500;border-radius:8px;transition:all .15s}
    .sidebar nav a:hover{color:#e2e8f0;background:rgba(255,255,255,.05)}
    .sidebar nav a.active{color:white;background:rgba(16,185,129,.15)}
    .nav-icon{font-size:16px;width:20px;text-align:center}
    .sidebar-footer{padding:16px 20px;border-top:1px solid rgba(255,255,255,.06)}
    .logout-btn{width:100%;padding:8px 12px;background:transparent;border:1px solid rgba(255,255,255,.1);color:#64748b;border-radius:6px;font-size:12px;cursor:pointer;transition:all .15s}
    .logout-btn:hover{background:rgba(255,255,255,.05);color:#94a3b8}

    .main{margin-left:220px;padding:28px 32px;max-width:960px}
    .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
    .page-header h1{font-size:20px;font-weight:800;color:#0f172a}
    .header-sub{font-size:12px;color:#94a3b8;margin-top:3px;font-family:'SF Mono','Fira Code',monospace}
    .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;transition:all .15s;text-decoration:none}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn-primary{background:#10b981;color:white}
    .btn-primary:hover{background:#059669}
    .btn-back{background:#e2e8f0;color:#475569}
    .btn-back:hover{background:#cbd5e1}
    .btn-danger{background:#fef2f2;color:#dc2626}
    .btn-danger:hover{background:#fee2e2}

    .edit-card{background:white;border-radius:12px;padding:24px;border:1px solid #e2e8f0}
    .form-group{margin-bottom:16px}
    .form-group label{display:block;font-size:12px;font-weight:600;color:#64748b;margin-bottom:6px;text-transform:uppercase;letter-spacing:.04em}
    .form-group input,.form-group textarea,.form-group select{width:100%;padding:9px 12px;border:1px solid #e2e8f0;border-radius:8px;font-size:13px;color:#1e293b;outline:none;font-family:inherit;transition:all .15s;background:white}
    .form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,.1)}
    .form-group textarea{min-height:500px;font-family:'SF Mono','Fira Code','Consolas',monospace;font-size:13px;line-height:1.6;resize:vertical;tab-size:2}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .actions{display:flex;gap:10px;margin-top:20px}
    .msg{padding:10px 14px;border-radius:8px;font-size:13px;margin-top:12px;display:none}
    .msg-success{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0}
    .msg-error{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}
    .loading{text-align:center;padding:60px;color:#94a3b8;font-size:14px}
    .type-badge{display:inline-block;padding:3px 10px;border-radius:5px;font-size:11px;font-weight:700;margin-left:8px}
    .type-astro{background:#ede9fe;color:#7c3aed}
    .type-md{background:#ecfdf5;color:#059669}
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="sidebar-header">
      <a href="/admin/parking/" class="sidebar-logo">
        <div class="logo-icon">P</div>
        ParkingMap
      </a>
    </div>
    <nav>
      <a href="/admin/parking/"><span class="nav-icon">ğŸ…¿ï¸</span> ì£¼ì°¨ì¥ ê´€ë¦¬</a>
      <a href="/admin/blog/" class="active"><span class="nav-icon">ğŸ“</span> ë¸”ë¡œê·¸ ê´€ë¦¬</a>
    </nav>
    <div class="sidebar-footer">
      <button class="logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </aside>

  <div class="main">
    <div class="page-header">
      <div>
        <h1 id="pageTitle">ë¸”ë¡œê·¸ ê¸€ í¸ì§‘</h1>
        <p class="header-sub" id="filePath"></p>
      </div>
      <a href="/admin/blog/" class="btn btn-back">â† ëª©ë¡ìœ¼ë¡œ</a>
    </div>

    <div id="loadingState" class="loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

    <!-- ë§ˆí¬ë‹¤ìš´ í¸ì§‘ í¼ -->
    <div class="edit-card" id="mdForm" style="display:none;">
      <form id="mdFormInner">
        <div class="form-group">
          <label>ì œëª©</label>
          <input type="text" id="title" required />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>ìŠ¬ëŸ¬ê·¸ (URL) â€” ë³€ê²½ ë¶ˆê°€</label>
            <input type="text" id="slug" readonly style="background:#f8fafc;color:#94a3b8;" />
          </div>
          <div class="form-group">
            <label>ë‚ ì§œ</label>
            <input type="date" id="date" required />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>ì¹´í…Œê³ ë¦¬</label>
            <select id="category" style="cursor:pointer;">
              <option value="ë¸”ë¡œê·¸">ë¸”ë¡œê·¸</option>
              <option value="ì£¼ì°¨ì¥">ì£¼ì°¨ì¥</option>
            </select>
          </div>
          <div class="form-group">
            <label>ì§§ì€ ì´ë¦„ (ì„ íƒ)</label>
            <input type="text" id="breadcrumbName" placeholder="ë¹µê°€ë£¨ í‘œì‹œìš© ì§§ì€ ì´ë¦„" />
          </div>
        </div>
        <input type="hidden" id="notionPageId" />
        <div class="form-group">
          <label>ì„¤ëª… (SEO)</label>
          <input type="text" id="description" required />
        </div>
        <div class="form-group">
          <label>ë³¸ë¬¸ (Markdown)</label>
          <textarea id="content" required></textarea>
        </div>
        <div class="actions">
          <button type="submit" class="btn btn-primary" id="mdSaveBtn">ì €ì¥</button>
          <button type="button" class="btn btn-danger" id="mdDeleteBtn">ì‚­ì œ</button>
        </div>
        <div class="msg msg-success" id="mdSuccess"></div>
        <div class="msg msg-error" id="mdError"></div>
      </form>
    </div>

    <!-- ë ˆê±°ì‹œ(.astro) í¸ì§‘ í¼ -->
    <div class="edit-card" id="legacyForm" style="display:none;">
      <form id="legacyFormInner">
        <div class="form-group">
          <label>ì†ŒìŠ¤ ì½”ë“œ (.astro)</label>
          <textarea id="legacyContent" style="min-height:600px;"></textarea>
        </div>
        <div class="actions">
          <button type="submit" class="btn btn-primary" id="legacySaveBtn">GitHubì— ì €ì¥</button>
          <a href="/admin/blog/" class="btn btn-back">ì·¨ì†Œ</a>
        </div>
        <div class="msg msg-success" id="legacySuccess"></div>
        <div class="msg msg-error" id="legacyError"></div>
      </form>
    </div>
  </div>

  <script is:inline>
    const params = new URLSearchParams(window.location.search);
    const slug = params.get('slug');
    const type = params.get('type');
    const isLegacy = type === 'legacy';
    const isParkingEditorial = type === 'parking-editorial';

    if (!slug) {
      document.getElementById('loadingState').textContent = 'ìŠ¬ëŸ¬ê·¸ê°€ ì§€ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
    } else if (isLegacy) {
      loadLegacy(slug);
    } else {
      loadMarkdown(slug);
    }

    // --- ë ˆê±°ì‹œ (.astro) í¸ì§‘ ---
    async function loadLegacy(slug) {
      const titleEl = document.getElementById('pageTitle');
      const pathEl = document.getElementById('filePath');
      const filePath = 'src/pages/blog/' + slug + '.astro';
      titleEl.innerHTML = slug + ' <span class="type-badge type-astro">Astro</span>';
      pathEl.textContent = filePath;
      try {
        const res = await fetch('/api/admin/blog/?slug=' + slug + '&type=legacy');
        const data = await res.json();
        if (!res.ok) throw new Error(data.error);
        document.getElementById('legacyContent').value = data.content;
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('legacyForm').style.display = 'block';
      } catch (e) {
        document.getElementById('loadingState').textContent = 'ë¡œë“œ ì‹¤íŒ¨: ' + e.message;
      }
    }

    document.getElementById('legacyFormInner').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('legacySaveBtn');
      const ok = document.getElementById('legacySuccess');
      const err = document.getElementById('legacyError');
      btn.disabled = true; btn.textContent = 'ì €ì¥ ì¤‘...';
      ok.style.display = 'none'; err.style.display = 'none';
      try {
        const res = await fetch('/api/admin/blog/', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ slug, type: 'legacy', content: document.getElementById('legacyContent').value }),
        });
        const result = await res.json();
        if (res.ok) { ok.textContent = 'ì €ì¥ ì™„ë£Œ! Vercel ìë™ ë°°í¬ê°€ ì‹œì‘ë©ë‹ˆë‹¤.'; ok.style.display = 'block'; }
        else { err.textContent = result.error || 'ì €ì¥ ì‹¤íŒ¨'; err.style.display = 'block'; }
      } catch (ex) { err.textContent = 'ì„œë²„ ì˜¤ë¥˜: ' + ex.message; err.style.display = 'block'; }
      finally { btn.disabled = false; btn.textContent = 'GitHubì— ì €ì¥'; }
    });

    // --- ë§ˆí¬ë‹¤ìš´ í¸ì§‘ ---
    async function loadMarkdown(slug) {
      const titleEl = document.getElementById('pageTitle');
      const label = isParkingEditorial ? 'ì£¼ì°¨ì¥ ì—ë””í† ë¦¬ì–¼ í¸ì§‘' : 'ë¸”ë¡œê·¸ ê¸€ í¸ì§‘';
      const dir = isParkingEditorial ? 'src/content/parking-editorial/' : 'src/content/blog/';
      titleEl.innerHTML = label + ' <span class="type-badge type-md">Markdown</span>';
      document.getElementById('filePath').textContent = dir + slug + '.md';
      try {
        const apiUrl = isParkingEditorial
          ? '/api/admin/blog/?slug=' + slug + '&type=parking-editorial'
          : '/api/admin/blog/?slug=' + slug;
        const res = await fetch(apiUrl);
        const data = await res.json();
        if (!res.ok) throw new Error(data.error);
        document.getElementById('title').value = data.title;
        document.getElementById('slug').value = data.slug;
        document.getElementById('date').value = data.date;
        document.getElementById('description').value = data.description;
        document.getElementById('content').value = data.content;
        document.getElementById('category').value = data.category || 'ë¸”ë¡œê·¸';
        document.getElementById('breadcrumbName').value = data.breadcrumbName || '';
        document.getElementById('notionPageId').value = data.notionPageId || '';
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('mdForm').style.display = 'block';
      } catch (e) {
        document.getElementById('loadingState').textContent = 'ë¡œë“œ ì‹¤íŒ¨: ' + e.message;
      }
    }

    document.getElementById('mdFormInner').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('mdSaveBtn');
      const ok = document.getElementById('mdSuccess');
      const err = document.getElementById('mdError');
      btn.disabled = true; btn.textContent = 'ì €ì¥ ì¤‘...';
      ok.style.display = 'none'; err.style.display = 'none';
      try {
        const res = await fetch('/api/admin/blog/', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            slug: document.getElementById('slug').value,
            type: isParkingEditorial ? 'parking-editorial' : undefined,
            title: document.getElementById('title').value,
            date: document.getElementById('date').value,
            description: document.getElementById('description').value,
            content: document.getElementById('content').value,
            category: document.getElementById('category').value,
            breadcrumbName: document.getElementById('breadcrumbName').value || undefined,
            notionPageId: document.getElementById('notionPageId').value || undefined,
          }),
        });
        const result = await res.json();
        if (res.ok) { ok.textContent = 'ì €ì¥ ì™„ë£Œ!'; ok.style.display = 'block'; }
        else { err.textContent = result.error || 'ì €ì¥ ì‹¤íŒ¨'; err.style.display = 'block'; }
      } catch (ex) { err.textContent = 'ì„œë²„ ì˜¤ë¥˜: ' + ex.message; err.style.display = 'block'; }
      finally { btn.disabled = false; btn.textContent = 'ì €ì¥'; }
    });

    document.getElementById('mdDeleteBtn').addEventListener('click', async () => {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      try {
        const res = await fetch('/api/admin/blog/', {
          method: 'DELETE',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ slug: document.getElementById('slug').value, type: isParkingEditorial ? 'parking-editorial' : undefined }),
        });
        if (res.ok) { alert('ì‚­ì œ ì™„ë£Œ!'); window.location.href = '/admin/blog/'; }
        else { const r = await res.json(); alert('ì‚­ì œ ì‹¤íŒ¨: ' + (r.error || '')); }
      } catch (ex) { alert('ì„œë²„ ì˜¤ë¥˜: ' + ex.message); }
    });

    document.getElementById('logoutBtn').addEventListener('click', async () => {
      await fetch('/api/auth/logout/', { method: 'POST' });
      window.location.href = '/admin/login/';
    });
  </script>
</body>
</html>
